# Copyright (c) 2025 Arribada Initiative
# SPDX-License-Identifier: Apache-2.0

# This is an alternative configuration that uses RTT for logging
# instead of UART console
#
# To use: west build -b nrf52840dk_nrf52840 samples/ota_test -- -DCONF_FILE=prj_rtt.conf

# Include base configuration
# (Note: Manually copy settings from prj.conf or use this as base)

# Logging
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=3
CONFIG_LOG_MODE_IMMEDIATE=y

# Serial/UART support (still needed for Argos SMD communication)
CONFIG_SERIAL=y
CONFIG_UART_INTERRUPT_DRIVEN=y

# Argos SMD driver
CONFIG_ARGOS_SMD=y
CONFIG_ARGOS_SMD_LOG_LEVEL_INF=y

# Argos DFU/OTA support
CONFIG_ARGOS_DFU=y
CONFIG_ARGOS_DFU_LOG_LEVEL_INF=y

# Heap for buffers
CONFIG_HEAP_MEM_POOL_SIZE=8192

# Main stack size (increase if needed for large firmware images)
CONFIG_MAIN_STACK_SIZE=4096

# System workqueue stack size
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048

# ===== RTT CONFIGURATION =====

# Enable SEGGER RTT
CONFIG_USE_SEGGER_RTT=y

# RTT Console (for printf-like output)
CONFIG_RTT_CONSOLE=y

# Use RTT as the log backend (instead of UART)
CONFIG_LOG_BACKEND_RTT=y

# RTT mode: drop messages if buffer full (prevents blocking)
CONFIG_LOG_BACKEND_RTT_MODE_DROP=y

# Disable UART console since we're using RTT for logs
# (UART is still active for Argos SMD module communication)
CONFIG_UART_CONSOLE=n

# RTT Buffer Sizes (increase for higher log volume)
CONFIG_SEGGER_RTT_BUFFER_SIZE_UP=4096    # Host <- Target
CONFIG_SEGGER_RTT_BUFFER_SIZE_DOWN=16    # Host -> Target

# Number of RTT buffers
CONFIG_SEGGER_RTT_MAX_NUM_UP_BUFFERS=3
CONFIG_SEGGER_RTT_MAX_NUM_DOWN_BUFFERS=3

# RTT Mode
# 0 = Skip (drop if full)
# 1 = Trim (trim message if full)
# 2 = Block (wait for space - can hang!)
CONFIG_SEGGER_RTT_MODE=0

# Optional: Enable full OTA update test (WARNING: performs real firmware update)
# CONFIG_ARGOS_OTA_TEST_FULL_UPDATE=y

# Optional: Enable stress tests (repeated OTA updates)
# CONFIG_ARGOS_OTA_TEST_STRESS=y
