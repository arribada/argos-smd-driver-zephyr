# Copyright (c) 2025 Arribada Initiative
# SPDX-License-Identifier: Apache-2.0

menuconfig ARGOS_SMD
    bool "Argos SMD satellite modem driver"
    help
      Enable Argos SMD satellite modem driver. This driver supports
      communication with Argos SMD modules via UART (AT commands) or
      SPI (Protocol A+).

if ARGOS_SMD

choice ARGOS_SMD_TRANSPORT
    prompt "Transport interface"
    default ARGOS_SMD_UART

config ARGOS_SMD_UART
    bool "UART (AT commands)"
    depends on UART_INTERRUPT_DRIVEN
    help
      Use UART with AT commands for communication with Argos SMD modules.
      This is the standard interface supporting all AT commands.

config ARGOS_SMD_SPI
    bool "SPI (Protocol A+)"
    depends on SPI
    help
      Use SPI with Protocol A+ binary framing for communication.
      Frame format: [MAGIC(1)] [SEQ(1)] [CMD(1)] [LEN(1)] [DATA(0-250)] [CRC(1)]
      Uses CRC-8 CCITT (polynomial 0x07).

endchoice

# Logging for main driver
module = ARGOS_SMD
module-str = Argos SMD
source "subsys/logging/Kconfig.template.log_config"

# UART-specific configuration
if ARGOS_SMD_UART

# No additional UART-specific configs needed for now

endif # ARGOS_SMD_UART

# SPI-specific configuration
if ARGOS_SMD_SPI

config ARGOS_SMD_SPI_INIT_PRIORITY
    int "Argos SMD SPI driver init priority"
    default 60
    help
      Initialization priority for Argos SMD SPI driver.

endif # ARGOS_SMD_SPI

# DFU support (works with both UART and SPI)
config ARGOS_SMD_DFU
    bool "Enable Device Firmware Update (DFU) support"
    help
      Enable Device Firmware Update (DFU) support for Argos SMD modules.
      This provides an API to perform firmware updates via the selected
      transport interface (UART or SPI).

      DFU Sequence:
      1. Enter bootloader (CMD_DFU_ENTER 0x3F)
      2. Ping bootloader (DFU_PING 0x30)
      3. Get bootloader info (DFU_GET_INFO 0x31)
      4. Erase flash (DFU_ERASE 0x32)
      5. Write chunks (DFU_WRITE_REQ + DFU_WRITE_DATA)
      6. Verify CRC (DFU_VERIFY 0x37)
      7. Jump to app (DFU_JUMP 0x39)

if ARGOS_SMD_DFU
    module = ARGOS_SMD_DFU
    module-str = Argos SMD DFU
    source "subsys/logging/Kconfig.template.log_config"
endif

endif # ARGOS_SMD
